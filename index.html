<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>U+우리가게패키지 재약정신청서</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --u-magenta: #ec008b; --bg-gray: #f8f9fa; }
        body { background-color: var(--bg-gray); padding-bottom: 50px; font-family: 'Pretendard', sans-serif; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        .form-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid var(--u-magenta); padding-bottom: 20px; }
        .header h2 { color: var(--u-magenta); font-weight: 800; font-size: 1.6rem; }
        .step-indicator { text-align: center; color: #999; font-size: 0.9rem; margin-bottom: 20px; }
        .section-title { font-size: 1.1rem; font-weight: 700; color: #333; margin: 25px 0 15px; display: flex; align-items: center; }
        .section-title::before { content: ""; width: 5px; height: 18px; background: var(--u-magenta); margin-right: 10px; border-radius: 2px; }
        .form-label { font-weight: 600; font-size: 0.9rem; color: #555; }
        .form-control { padding: 13px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; }
        .bg-readonly { background-color: #f1f3f5 !important; color: #495057; font-weight: bold; }
        
        /* 약관 동의 박스 스타일 */
        .agreement-title { font-weight: 700; color: var(--u-magenta); margin-bottom: 8px; font-size: 0.95rem; }
        .agreement-box { 
            background: #fdfdfd; border: 1px solid #eee; border-radius: 10px; padding: 15px; 
            font-size: 0.82rem; color: #666; max-height: 150px; overflow-y: auto; line-height: 1.6; margin-bottom: 20px;
        }
        .notice-box { background-color: #fff0f7; border-left: 4px solid var(--u-magenta); padding: 12px; margin-bottom: 20px; font-size: 0.85rem; line-height: 1.6; color: #333; }
        .notice-box b { color: var(--u-magenta); }

        .btn-magenta { background: var(--u-magenta); color: white; border: none; width: 100%; padding: 16px; border-radius: 12px; font-weight: bold; font-size: 1.1rem; }
        .btn-magenta:disabled { background: #ccc; }
        
        .signature-wrapper { background: #fff; border: 2px solid #eee; border-radius: 10px; width: 100%; height: 200px; touch-action: none; position: relative; }
        canvas { width: 100%; height: 100%; }
        #sig-placeholder { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ccc; pointer-events: none; font-weight: bold; }
        
        /* 페이지 전환용 */
        .step-page { display: none; }
        .step-active { display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-card">
        <div class="header">
            <h2>U+우리가게패키지 재약정신청서</h2>
        </div>

        <div id="step1" class="step-page step-active">
            <div class="step-indicator">(1/2) 정보 확인 및 입력</div>
            
            <div class="section-title">가입자 기본 정보</div>
            <div class="row g-2 mb-3">
                <div class="col-6">
                    <label class="form-label">청구서번호</label>
                    <input type="text" id="billNumber" class="form-control bg-readonly" readonly>
                </div>
                <div class="col-6">
                    <label class="form-label">신청일</label>
                    <input type="text" id="applyDate" class="form-control bg-readonly" readonly>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">고객명</label>
                <input type="text" id="custName" class="form-control bg-readonly" readonly>
            </div>
            <div class="mb-3">
                <label class="form-label">연락처*</label>
                <input type="tel" id="custTel" class="form-control" placeholder="010-0000-0000">
            </div>
            <div class="mb-3">
                <label class="form-label">사업자등록번호*</label>
                <input type="tel" id="bizNum" class="form-control" placeholder="000-00-00000" inputmode="numeric">
            </div>
            <div class="mb-3">
                <label class="form-label">생년월일*</label>
                <input type="tel" id="bizReg" class="form-control" placeholder="6자리 (예: 880101)" inputmode="numeric">
            </div>
            <div class="mb-3">
                <label class="form-label">설치 주소*</label>
                <input type="text" id="custAddr" class="form-control mb-2" readonly onclick="execDaumPostcode()" placeholder="주소 검색">
                <input type="text" id="custDetail" class="form-control" placeholder="상세주소 입력">
            </div>

            <div class="section-title">사은품 지급 계좌 정보</div>
            <div class="notice-box">
                <b>• 재약정 진행 시 사은금은 익월 20일 이후에 지급됩니다.</b><br>
                <b>• 본인명의 계좌만 지급 가능합니다.</b>
            </div>
            <div class="mb-3">
                <label class="form-label">확인된 사은금액 / 대상회선</label>
                <div class="row g-2">
                    <div class="col-6"><input type="text" id="giftAmount" class="form-control bg-readonly" readonly></div>
                    <div class="col-6"><input type="text" id="targetLine" class="form-control bg-readonly" readonly></div>
                </div>
            </div>
            <div class="row g-2 mb-3">
                <div class="col-4"><label class="form-label">은행명*</label><input type="text" id="bankName" class="form-control" placeholder="은행명"></div>
                <div class="col-8"><label class="form-label">계좌번호*</label><input type="tel" id="bankNo" class="form-control" placeholder="하이픈(-) 없이" inputmode="numeric"></div>
            </div>
            <div class="mb-4">
                <label class="form-label">예금주명*</label>
                <input type="text" id="bankOwner" class="form-control" placeholder="예금주 성함">
            </div>

            <button type="button" class="btn-magenta" onclick="nextStep()">다음 단계로 (2/2)</button>
        </div>

        <div id="step2" class="step-page">
            <div class="step-indicator">(2/2) 개인정보 활용 동의 및 서명</div>

            <div class="section-title">개인정보 활용 동의</div>

            <div class="mb-4">
                <div class="agreement-title">2. (필수) 개인정보 수집·이용 동의</div>
                <div class="agreement-box">
                   (1) 이용목적: 이용요금 연체정보 통지, 신용보험 가입, 신용도 판단

요금정산(청구/수납/채권추심/통신료 상호정산)

신청 서비스·상품 제공 및 안내, 이용 빈도 파악 및 통계학적 특성 기반 서비스 제공, 개인 맞춤형 서비스 제공

서비스·상품 개발/특화, 이용자·서비스 이용 통계/분석

고객관계관리(고지사항 전달, 서비스 이용상황 확인, 신청/해지 등 의사확인, 민원처리 의사소통, 단말기 안전점검, 멤버십 및 A/S 쿠폰 제공, 단말기 출시·변경, 요금 컨설팅, 요금할인 고객혜택 프로그램 안내)

업무처리(가입/개통/변경/사후관리/품질개선/해지)

명의도용 방지(등록된 이동전화로 가입사실 통보)

불량가입·편법영업·이상영업 확인

휴대폰 보험, 모바일뱅킹 제공 및 안내, 계약이행, 업무위탁, 해지 환급금 안내

출금계좌 등록 안내, 편의제공 및 불편사항 개선/서비스 품질 향상 분석

(2) 수집항목: 명의자(양도인): 이름(상호), 연락처, 이메일주소, 청구지주소, 주민등록주소, 개인식별정보(CI/DI), 서비스 가입 시 인증된 고객의 모바일 전화번호, 본인 명의 U+모바일 전화번호

납부자: 이름(상호), 휴대폰번호, 생년월일, 계좌번호, 은행명, 카드사명, 카드번호, 카드 유효기간, 명의자와의 관계

업무처리 필요 구비서류 이미지: 신분증, 위임장, 인감증명서, 복지감면 확인서류, 군입대 확인서류, 대리인 입증서류, 가족관계 확인 및 기타 사실 확인 증명서(대리인 신청 시 대리인 정보 포함)

생성 및 기타 수집정보: 단말기 정보(일련번호, MAC정보, 모델명, IMEI, UICC, IMSI), USIM정보, 신용정보, 과금정보, 품질정보, 이용/변경/가입정보, 쿠키 및 접속로그, 광고식별자, 접속 IP, 멤버십 정보, U+서비스 사용정보, 통계데이터, 웹사이트 설정정보, 신호세기, 상담내용(전화/챗봇/채팅/이메일 등), 위 개인정보를 조합하여 생성되는 정보

(3) 이용기간: 서비스 가입기간 동안 이용 및 요금정산 과·오납 등 분쟁대비를 위해 해지 후 요금완납 6개월까지 보유·이용 (관련 법령에 따라 보존이 필요한 경우 해당 법령에 따라 보유)

서비스 가입 과정에서 신청이 완료되지 않은 경우: 사유 확인 및 구비서류 보완 등을 위해 작성일로부터 3개월까지 보유

외국인 출국여부 확인: 체류기간까지

상담내용(전화/챗봇/채팅/이메일 등) 분석: 3년
                </div>
            </div>

            <div class="mb-4">
                <div class="agreement-title">3. (필수) 개인위치정보 수집·이용 동의</div>
                <div class="agreement-box">
                 (1) 이용목적: 위치기반 서비스 및 위치정보 서비스 안내·제공·요금정산

(2) 수집항목: 개인위치정보: 기지국, GPS, Wifi, RFID 태그 및 위치정보시스템을 통해 수집되는 위치정보

2항의 개인정보 및 개인위치정보를 조합하여 생성되는 정보

(3) 이용기간: 서비스 가입기간 동안 이용 및 분쟁대비를 위해 해지 후 요금완납 3개월까지
                </div>
            </div>

            <div class="mb-4">
                <div class="agreement-title">4. (필수) 개인정보 제3자 제공 및 조회 동의</div>
                <div class="agreement-box">
                    (1) 제공받는 자: 금융결제원, 각 은행, 카드사, NICE평가정보, 한국정보통신진흥협회 등<br>
                    (2) 이용목적: 요금수납, 본인인증, 신용도조회 등<br>
                    (3) 보유기간: 서비스 가입기간 및 법정 의무 보유기간
                </div>
            </div>

            <div class="mb-4">
                <div class="agreement-title">5. (필수) 문서상 동의 체크 항목</div>
                <div class="agreement-box">
                   (1) 개인정보 제공 활용 (제3자 제공): KB손해보험

금융결제원, 토스페이먼츠, 자동인출 신청 은행

금융결제원, KS-NET, 자동납부 신청 카드사, 자동인출 신청 은행

KIBNET, 토스페이먼츠, 자동인출 신청 은행

금융결제원, 토스페이먼츠, 자동납부 신청 카드사

금융결제원, KS-NET, 토스페이먼츠, 자동인출 신청 은행

(주)세종텔레콤

에스원

한국정보통신진흥협회, 행정안전부, 경찰청, 법무부, 보건복지부, 국가보훈처

한국정보통신진흥협회, 행정안전부, 법무부

행정안전부, 한국통신사업자연합회

한국정보통신진흥협회, 과학기술정보통신부

행정안전부, 보건복지부, 국가보훈처

한화손해보험(주)

(주)세종텔레콤, SK브로드밴드(주), 에스메이텔링크(주), (주)케이티, 한국케이블텔레콤, (주)씨제이헬로비전, 삼성에스디에스(주)

(주)LG전자, (주)삼성전자, (주)린나이코리아, (주)대성셀틱에너지스, (주)쿠첸, (주)미로, (주)선일, (주)쿠쿠전자, (주)콜로노비타

(주)인코어테크놀러지

(주)LG전자

세친구세무회계, (주)주피타카, (주)한국신용데이터, (주)비앤에이치코리아, (주)LG CNS, (주)토마토세븐, (주)스포카, (주)미디어윌네트웍스

(주)우아한형제들

개인정보 제공은 특정서비스 가입·이용 시에만 이루어지며, 제공 목적/정보/제공받는 자/보유·이용기간이 변동될 경우 홈페이지 개인정보 취급방침에 고지

(2) 개인정보 취급위탁: 수탁자: 우리신용정보(주), 고려신용정보(주), 미래신용정보(주), MG신용정보(주), (주)인텔리빅스

수탁업무 내용: 미납요금 안내 및 상담, 채권추심, 지능형CCTV 영상분석, 이벤트 관련 VOC 대응, 영상분석 품질 개선 등

지능형CCTV 녹화/감지영상(침입·배회·유기·불꽃·연기감지 등), 감지설정(감지영역/스케줄) 등

(3) 개인신용정보조회: 한국정보통신진흥협회

(주)NICE평가정보

(제공하는자: 한국정보통신진흥협회 → 제공받는자: LG유플러스)

조회 결과에 따라 청약 승낙을 유보할 수 있으며, 본 조회는 신용등급에 영향 없음

(4) 기타: Msafer(명의도용 방지 서비스): 신규 가입 시 명의도용 방지를 위해 한국정보통신진흥협회 및 타 통신사업자에 제공하여 기존 사용 중인 전화로 개통사실 통보

개인정보 침해신고: 1544-0010/0001, 101, privacy@lguplus.co.kr

(개인정보 관리 책임자: 고객보호팀장)

동의 거부 가능, 미동의 시 서비스 가입·이용 제약 가능, 미동의 시 정보 미제공. 위탁·제공 현황 및 변동사항은 홈페이지 개인정보취급방침에 공개 </div>
                </div>
                <div class="mb-4">

                <div class="agreement-title">5. (필수) 문서상 동의 체크 항목</div>

                <div class="agreement-box">(1) 필수 개인신용정보 조회 동의: 본인은 하기 내용에 충분히 이해하고 동의합니다.

                (2) 필수 개인정보 취급위탁 동의: 본인은 하기 내용에 충분히 이해하고 동의합니다.</div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="allAgreeCheck">
                    <label class="form-check-label fw-bold text-dark" for="allAgreeCheck">모든 필수 항목에 동의합니다.</label>
                </div>
            </div>

            <div class="section-title">신청인 확인 서명</div>
            <div class="signature-wrapper">
                <div id="sig-placeholder">여기에 서명해 주세요</div>
                <canvas id="signature-pad"></canvas>
            </div>
            <div class="text-end mt-2 mb-4">
                <button type="button" class="btn btn-sm btn-light" onclick="clearSignature()">다시 쓰기</button>
            </div>

            <div class="row g-2">
                <div class="col-4"><button type="button" class="btn btn-secondary w-100 py-3 rounded-3" onclick="prevStep()">이전</button></div>
                <div class="col-8"><button type="button" class="btn-magenta" id="submitBtn" onclick="submitData()">제출 완료</button></div>
            </div>
        </div>
    </div>
</div>

<script>
    let signaturePad;
    const gasUrl = "https://script.google.com/macros/s/AKfycbweSufLj2z_BOMsnZymvY8-IgkPVmw_vq9eaMwv0xU86bibKVL38MbW-JqXmxryQF_aXA/exec";

    window.addEventListener('DOMContentLoaded', () => {
        // 데이터 파싱 및 초기화
        const params = new URLSearchParams(window.location.search);
        document.getElementById('billNumber').value = params.get('bill') || "";
        document.getElementById('custName').value = decodeURIComponent(params.get('name') || "");
        document.getElementById('custTel').value = params.get('tel') || "";
        document.getElementById('targetLine').value = decodeURIComponent(params.get('line') || "");
        const gift = params.get('gift');
        document.getElementById('giftAmount').value = gift ? Number(gift).toLocaleString() + "원" : "";
        
        const now = new Date();
        document.getElementById('applyDate').value = `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;

        // 서명 패드 초기화
        const canvas = document.getElementById('signature-pad');
        signaturePad = new SignaturePad(canvas, { minWidth: 3, maxWidth: 7, penColor: "black" });
        
        const hidePlaceholder = () => { document.getElementById('sig-placeholder').style.display = 'none'; };
        canvas.addEventListener('mousedown', hidePlaceholder);
        canvas.addEventListener('touchstart', hidePlaceholder);
        
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();
    });

    function nextStep() {
        const required = ['custTel', 'bizNum', 'bizReg', 'custAddr', 'bankName', 'bankNo', 'bankOwner'];
        for(let id of required) {
            if(!document.getElementById(id).value) { alert("모든 필수 항목(*)을 입력해 주세요."); return; }
        }
        document.getElementById('step1').classList.remove('step-active');
        document.getElementById('step2').classList.add('step-active');
        resizeCanvas();
        window.scrollTo(0,0);
    }

    function prevStep() {
        document.getElementById('step2').classList.remove('step-active');
        document.getElementById('step1').classList.add('step-active');
        window.scrollTo(0,0);
    }

    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('custAddr').value = data.roadAddress;
                document.getElementById('custDetail').focus();
            }
        }).open();
    }

    function clearSignature() {
        signaturePad.clear();
        document.getElementById('sig-placeholder').style.display = 'block';
    }

    function resizeCanvas() {
        const canvas = document.getElementById('signature-pad');
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);
    }

    function submitData() {
        if(!document.getElementById('allAgreeCheck').checked) { alert("모든 필수 항목 동의에 체크해 주세요."); return; }
        if(signaturePad.isEmpty()) { alert("서명을 완료해 주세요."); return; }

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "제출 중...";

        const allData = {
            billNumber: document.getElementById('billNumber').value,
            custName: document.getElementById('custName').value,
            custTel: document.getElementById('custTel').value,
            bizNum: document.getElementById('bizNum').value,
            bizReg: document.getElementById('bizReg').value,
            custAddr: document.getElementById('custAddr').value + " " + document.getElementById('custDetail').value,
            targetLine: document.getElementById('targetLine').value,
            giftAmount: document.getElementById('giftAmount').value,
            bankAccount: `${document.getElementById('bankName').value} / ${document.getElementById('bankNo').value} / ${document.getElementById('bankOwner').value}`,
            signature: signaturePad.toDataURL()
        };

        fetch(gasUrl, { method: 'POST', body: JSON.stringify(allData) })
        .then(r => r.json())
        .then(res => {
            if(res.result === "success") {
                alert("제출이 완료되었습니다!");
                location.href = "view.html?bill=" + allData.billNumber; // 완료 페이지 이동
            } else {
                alert("오류: " + res.message);
                btn.disabled = false;
            }
        }).catch(e => {
            alert("전송 중 오류 발생");
            btn.disabled = false;
        });
    }
</script>
</body>
</html>
